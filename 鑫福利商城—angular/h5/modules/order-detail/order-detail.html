<div class="app-container with-navbar with-tabbar" ng-controller="OrderDetailController">

    <div class="navbar fixed-top">
        <div class="navbar-left hide-weixin" ng-click="goBack()">
            <img class="button-icon" ng-src="image/nav-left.png"/>
            <div class="button-text">返回</div>
        </div>
        <div class="navbar-title">
          订单详情
        </div>
    </div>

    <div class="app-content" ng-if="isLoaded">

        <!-- Status -->
        <!--
        <div class="order-status" ng-if="order.status == ENUM.ORDER_STATUS.CREATED">
            <img ng-src="image/icon-order-light.png">等待买家付款
        </div>
        <div class="order-status" ng-if="order.status == ENUM.ORDER_STATUS.PAID">
            <img ng-src="image/icon-order-light.png">等待卖家发货
        </div>
        <div class="order-status" ng-if="order.status == ENUM.ORDER_STATUS.DELIVERING">
            <img ng-src="image/icon-order-light.png">等待买家收货
        </div>
        <div class="order-status" ng-if="order.status == ENUM.ORDER_STATUS.DELIVERIED">
            <img ng-src="image/icon-order-light.png">交易成功
        </div>
        <div class="order-status" ng-if="order.status == ENUM.ORDER_STATUS.FINISHED">
            <img ng-src="image/icon-order-light.png">交易成功
        </div>
        <div class="order-status" ng-if="order.status == ENUM.ORDER_STATUS.CANCELLED">
            <img ng-src="image/icon-order-light.png">交易取消
        </div>
        -->

        <!-- Address -->
        <div class="order-address" ng-if="order.is_real">
            <div class="address-contact">
                {{order.consignee.name}} {{order.consignee.mobile || order.consignee.tel}}
            </div>
            <div class="address-detail">
                {{order.consignee.regions}}
                &nbsp;
                {{order.consignee.address}}
            </div>
        </div>

  <!--场馆预定-->
        <div class="order-summury" style="padding-bottom:0.2rem;padding-top:0" ng-if="!order.is_real&&is_yd">
            <div class="summury-detail">
                预订人姓名 <span class="total-price">{{bookcon.name}}</span>
            </div>
            <div class="summury-detail">
                预订日期 <span class="total-price">{{bookcon.book_date}}</span>
            </div>
            <div class="summury-detail" ng-if="is_yd_h">
                预订时段 <span class="total-price">{{bookcon.start_hour}}:00-{{bookcon.end_hour}}:00</span>
            </div>
            <div class="summury-detail" ng-if="is_yd_h">
               下场人数 <span class="total-price">{{bookcon.people_num}}</span>
            </div>
            <div class="summury-detail" ng-if="!is_yd_h">
                下场人数 <span class="total-price">{{order.goods[0].total_amount}}</span>
            </div>
            <div class="summury-detail" ng-if="is_yd_h">
                预订片数 <span class="total-price">1</span>
            </div>
        </div>

        <div class="order-summury" style="padding-bottom:0.2rem;padding-top:0" ng-if="!order.is_real&&is_yd">
            <div class="summury-detail">
                留言 <span class="total-price" style="font-size: 0.24rem;">{{bookcon.note}}</span>
            </div>
            <div class="summury-detail" >
                接收短信手机 <span class="total-price">{{bookcon.telphone}}</span>
            </div>

        </div>

        <!-- Goods -->
        <div class="order-goods">
            <div class="goods-item detail-goods-item" ng-repeat="goods in order.goods track by $index">
                <div class="item-photo">
                    <img ng-show="goods.is_zx_order==0" ng-src="image/default-photo.png" lazy-img="{{goods.product.default_photo.thumb}}" ng-click="touchProduct(goods.product)"/>
                    <img ng-show="goods.is_zx_order==1" ng-src="image/default-photo.png" lazy-img="{{goods.product.default_photo.thumb}}"/>
                </div>
                <div class="item-info">
                    <div class="info-name">
                        {{goods.product.name}}【{{goods.order_status_text}}】
                    </div>
                    <div class="info-attr">
                        {{goods.property}}
                    </div>
                    <div class="info-price">
                        {{goods.product_price| currency:"￥"}}
                    </div>
                    <div class="info-amount">
                        x{{goods.total_amount}}
                    </div>
                </div>
                <div class="item-info-button">
                    订单编号：#{{order.sn}}-{{goods.order_goods_id}}

                    <a ng-if="(goods.order_status == ENUM.ORDER_GOODS_STATUS.PAID && goods.company_id!=70  && goods.company_id!=40 && goods.company_id!=51 && goods.company_id!=52 && goods.is_zx_order==0) || (goods.order_status == ENUM.ORDER_GOODS_STATUS.DELIVERY && goods.company_id!=40 && goods.is_zx_order==0)" ng-click="touchToRefund(goods.order_goods_id)">申请退款</a>
                    <a ng-if="(goods.order_status == ENUM.ORDER_GOODS_STATUS.APPLY_REFUND && goods.company_id!=40 && goods.company_id!=51 && goods.company_id!=52) || (goods.order_status == ENUM.ORDER_GOODS_STATUS.REFUNDED && goods.company_id!=40)" ng-click="touchToRefundInfo(goods.order_goods_id)">退款详情</a>

                    <a ng-if="goods.order_status == ENUM.ORDER_GOODS_STATUS.DELIVERIED && goods.is_zx_order==0 && goods.company_id!=70 && goods.company_id!=51 && goods.company_id!=52 " ng-click="touchToRefund(goods.order_goods_id)">申请退货</a>
                    <a ng-if="goods.order_status == ENUM.ORDER_GOODS_STATUS.APPLY_RETURN || goods.order_status == ENUM.ORDER_GOODS_STATUS.RETURNING || goods.order_status == ENUM.ORDER_GOODS_STATUS.RETURNED" ng-click="touchToRefundInfo(goods.order_goods_id)">退货详情</a>
                    <a ng-if="(goods.order_status == ENUM.ORDER_GOODS_STATUS.DELIVERIED ||goods.order_status == ENUM.ORDER_GOODS_STATUS.APPLY_RETURN || goods.order_status == ENUM.ORDER_GOODS_STATUS.RETURNING || goods.order_status == ENUM.ORDER_GOODS_STATUS.RETURNED)&& goods.is_reviewed==false" ng-click="touchComment(goods.id)">评价</a>
                    <a ng-if="goods.order_status == ENUM.ORDER_GOODS_STATUS.DELIVERING" ng-click="touchConfirm(goods.order_goods_id)">确认收货</a>
                </div>
            </div>
        </div>

        <!-- Total -->
        <div class="order-summury">
            <div class="summury-detail" style="height:28px;line-height: 28px">
                运费金额 <span class="total-price">+ {{order.shipping.price| currency:"￥"}}</span>
            </div>
            <div class="summury-total" style="height:28px;line-height: 28px">
                订单总价 <span class="total-price">= {{order.total| currency:"￥"}}</span>
            </div>
            <div class="summury-total" ng-if="order.balance_paid > 0" style="height:28px;line-height: 28px">
                账户抵扣金额 <span class="total-price">- {{order.balance_paid| currency:"￥"}}</span>
            </div>
            <div class="summury-total" ng-if="order.money_paid > 0" style="height:28px;line-height: 28px">
                现金支付金额 <span class="total-price">- {{order.money_paid| currency:"￥"}}</span>
            </div>
            <div class="summury-total" style="height:28px;line-height: 28px">
                优惠券 <span class="total-price">- {{order.coupon_deduction_price| currency:"￥"}}</span>
            </div>
        </div>

        <!-- 虚拟卡列表 -->
        <div class="order-info" ng-if="order.is_real == 0" style="padding:0 0.1rem;margin-top:0.2rem;overflow: unset;">
            <div class="info-text" ng-repeat="virtual_card in order.virtual_cards track by $index">
                {{virtual_card}}
            </div>
        </div>

        <!-- Info -->
        <div class="order-info">
            <div class="info-text">
                订单编号：#{{order.sn}}
            </div>
            <div class="info-text">
                创建时间：{{order.created_at | localTime}}
            </div>
            <div class="info-text" ng-if="order.updated_at">
                更新时间：{{order.updated_at | localTime}}
            </div>
            <div class="info-text" ng-if="order.paied_at">
                支付时间：{{order.paied_at | localTime}}
            </div>
            <div class="info-text" ng-if="order.shipping_at">
                发货时间：{{order.shipping_at | localTime}}
            </div>
            <div class="info-text" ng-if="order.finish_at">
                完成时间：{{order.finish_at | localTime}}
            </div>
            <div class="info-text" ng-if="order.canceled_at">
                取消时间：{{order.canceled_at | localTime}}
            </div>
            <!--<div class="info-text" ng-repeat="goods in order.goods track by $index" ng-if="goods.shipping_sn">-->
                <!--{{goods.shipping_name}}：{{goods.shipping_sn}}-->
            <!--</div>-->
        </div>


    <!-- Dialog -->
        <div id="dialog" ng-show="showDialog">
            <div class="mask">
            </div>
            <div class="dialog danger">
                <div class="dialog-title">
                    确认取消
                </div>
                <div class="dialog-content">
                    是否取消该订单
                </div>
                <div class="dialog-button">
                    <div class="button left" ng-click="touchDialogCancel()">
                        取消
                    </div>
                    <div class="button right" ng-click="touchDialogConfirm()">
                        确认
                    </div>
                </div>
            </div>
        </div>

        <!-- Submit -->

        <div class="order-submit fixed-bottom" ng-if="order.pay_status == ENUM.PAY_STATUS.UNPAY || ENUM.PAY_STATUS.UNPAY">
            <div class="submit-button dark" ng-if="order.pay_status == ENUM.PAY_STATUS.UNPAY" ng-click="touchPay()">
                付款
            </div>
            <div class="submit-button" ng-if="order.pay_status == ENUM.PAY_STATUS.UNPAY" ng-click="touchCancel()">
                取消订单
            </div>

            <!--
            <div class="submit-button dark" ng-if="order.status == ENUM.ORDER_STATUS.DELIVERING" ng-click="touchConfirm()">
                确认收货
            </div>

            <div class="submit-button" ng-if="order.status == ENUM.ORDER_STATUS.DELIVERING" ng-click="touchExpress()">
                查看物流
            </div>
            <div class="submit-button" ng-if="order.status == ENUM.ORDER_STATUS.FINISHED" ng-click="touchExpress()">
                查看物流
            </div>
            <div class="submit-button" ng-if="order.status == ENUM.ORDER_STATUS.DELIVERING" ng-click="touchExpress()">
                查看物流
            </div>
            -->
        </div>

    </div>

</div>


<style>

    .order-goods .goods-item .item-photo{
        border:0;
    }

    .order-goods .goods-item .item-info .info-name{
        overflow:hidden;
        text-overflow:ellipsis;
        display:-webkit-box;
        -webkit-box-orient:vertical;
        -webkit-line-clamp:2;
        font-size: 14px;
        line-height:17px;
    }
    body{
        background: #f4f4f4;
    }

    .order-address{
        width:7.2rem;
        margin:auto;
        border-radius: 0.2rem;
        border:none;
        margin-top:0.15rem;
    }

    .order-goods{
        width:7.2rem;
        margin:auto;
        border-radius: 0.2rem;
        border:none;
        margin-top:0.15rem;
        overflow: hidden;
        background: #fff;
    }
    .order-goods .goods-item .item-info-button{
        border:1px solid #f4f4f4;
    }
    .order-summury{
        width:7.2rem;
        margin:auto;
        border-radius: 0.2rem;
        border:none;
        margin-top:0.15rem;
        overflow: hidden;
        /*border-bottom: #f4f4f4 1px solid;*/
    }
    .order-info{
        width:7.2rem;
        margin:auto;
        border-radius: 0.2rem;
        border:none;
        margin-top:0.15rem;
        overflow: hidden;
    }
    .order-submit{
        background: #fff;
        border:none;
    }
    .order-info{
        padding-top:0.1rem;
        padding-bottom:0.1rem;
    }
    .order-summury{
        padding-top:0.1rem;
        padding-bottom:0.1rem;
    }

    .order-submit .submit-button{
        width:auto;
        height:33px;
        margin-top:5px;
        padding-left:0.5rem;
        padding-right:0.5rem;
        border-radius: 33px;
        margin-right:0.3rem;
        line-height:33px;
        border:none;
        background: #f4f4f4;
    }
    .order-goods .goods-item{
        padding-top:0.1rem;
        border-bottom:#f4f4f4 1px solid;
        height:auto;
    }

    .order-goods .goods-item .item-info-button{
        border:none;
        border-top:0 solid #f4f4f4;
        font-size: 0.26rem;
    }

    .order-goods .goods-item .item-info-button a{
        display: inline-block;
        width: 1.2rem;
        border-radius: 4px;
        margin-left:2px;
        line-height: 14px;
        font-size: 0.24rem;
        text-align: center;
    }
</style>
